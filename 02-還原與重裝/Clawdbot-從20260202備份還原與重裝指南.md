# OpenClaw（原 ClawdBot）還原與重裝指南 — 依官方實作與安全文檔

**備份日期**：2026-02-02  
**備份位置**：`/Users/user/Downloads/備份指南/clawdbot-full-backup-20260202/`  
**重裝依據**：以下步驟以您提供的兩份文檔為準，不另撰自訂流程。  
**防護對照**：重裝後請依「五、重裝後對應原防護層級」還原與健檢報告相同的防護（allowFrom、Control UI 僅本機、憑證權限、技能安全、Warn 三項對應）。

本指南做三件事：  
1. 指明**重裝與安全做法請依哪兩份文檔**；  
2. 說明如何把您現有的 **2026-02-02 備份**對應到重裝後的環境（若新安裝的是 OpenClaw，目錄與結構會與舊版 Clawdbot 不同）；  
3. **重裝後對應原本防護層級**（依《OpenClaw-安全與安裝健檢報告-2026-02-02.md》的 Warn 三項、allowFrom、Control UI 僅本機、憑證檔權限、技能安全）。

---

## 一、重裝時請依這兩份文檔操作

請**以這兩份文檔為準**進行安裝、設定與安全重裝，不要用先前我寫的自訂步驟：

| 文檔 | 用途 |
|------|------|
| **OpenClaw (原 ClawdBot) 全方位實作與安全指南 (1).md** | 專案背景、安全觀念、環境準備、安裝流程、引導精靈、啟動驗證、配對、應用層安全、技能安全、疑難排解、進階技巧。 |
| **OpenClaw 本機安裝與安全重裝指南.md** | 本機安裝（Node ≥ 22、一鍵腳本或手動 npm）、**安全備份與重新安裝的完整五步驟**（備份 → 解除安裝 → 重新安裝 → 還原 → 啟動驗證）。 |
| **OpenClaw-安全與安裝健檢報告-2026-02-02.md** | 重裝後**防護對照**：allowFrom、Control UI 僅本機、憑證權限、技能安全、Warn：3 的對應（見本指南「四、重裝後對應原防護層級」）。 |

路徑（您本機）：

- `/Users/user/Downloads/OpenClaw (原 ClawdBot) 全方位實作與安全指南 (1).md`
- `/Users/user/Downloads/OpenClaw 本機安裝與安全重裝指南.md`
- `/Users/user/Downloads/OpenClaw-安全與安裝健檢報告-2026-02-02.md`

---

## 二、依文檔的本機安裝與重裝流程（摘要）

以下僅摘錄兩份文檔重點，**詳細請直接看該兩份檔案**。

### 安裝（依「本機安裝與安全重裝指南」＋「全方位實作與安全指南」）

1. **環境**：Node.js ≥ 22（可用 nvm 安裝）。
2. **安裝方式（二擇一）**  
   - 一鍵腳本（推薦）：  
     `curl -fsSL https://openclaw.ai/install.sh | bash`  
   - 手動：  
     `npm install -g openclaw@latest`
3. **引導設定**：  
   `openclaw onboard --install-daemon`  
   （可選 `--install-daemon` 裝成背景服務；本機若遇網路問題，亦可改為手動執行 `openclaw gateway`。）
4. **驗證**：`openclaw status`、`openclaw health`、`openclaw doctor`、`openclaw logs`。  
5. **安全**：憑證權限、鎖定使用者權限、執行 `openclaw security audit --deep`（依「全方位實作與安全指南」）。

### 若要「先卸載再重裝」（依「本機安裝與安全重裝指南」）

1. **步驟一：備份** — 備份 `~/.openclaw/` 的 workspace、config、credentials、sessions（文檔內有完整路徑與指令）。  
2. **步驟二：解除安裝** — `openclaw uninstall --all --yes`。  
3. **步驟三：重新安裝** — 同上，一鍵腳本或 `npm install -g openclaw@latest`，再執行 `openclaw onboard`。  
4. **步驟四：還原** — 將備份複製回 `~/.openclaw/`（文檔內有還原指令）。  
5. **步驟五：啟動並驗證** — `openclaw gateway start`、`openclaw health`，並以對話確認記憶與知識。

---

## 三、您現有 2026-02-02 備份與 OpenClaw 的對應

您目前的備份是**舊版 Clawdbot** 的結構（`~/.clawdbot`、`clawdbot.json`、`agents/` 等）；新安裝若為 **OpenClaw**，會使用 `~/.openclaw/`、`config.json`、`credentials/`、`workspace/`、`sessions.json` 等。還原時需做**路徑與結構對應**。

### 備份目錄結構（clawdbot-full-backup-20260202）

| 備份內目錄/檔案 | 內容說明 |
|-----------------|----------|
| **clawdbot/**   | 舊版設定與資料：clawdbot.json、agents（auth、sessions）、memory、devices、identity、cron、media、telegram 等。 |
| **workspace-memory-and-knowledge/** | 工作區記憶與知識：MEMORY.md、SOUL.md、USER.md、memory/、docs/ 等。 |

### 還原到 OpenClaw（~/.openclaw）時的對應建議

- **工作區記憶與知識**  
  - 將 `workspace-memory-and-knowledge/` 的**全部內容**複製到 `~/.openclaw/workspace/`（或您設定的 workspace 路徑）。  
  - 即：MEMORY.md、SOUL.md、memory/、docs/ 等對應到 OpenClaw 的 workspace 結構（依官方「Memory」文件 [3]：長期記憶、每日記憶等）。

- **設定與憑證**  
  - OpenClaw 使用 `config.json` 與 `credentials/`；舊備份為 `clawdbot.json` 與 `agents/main/agent/auth-profiles.json`。  
  - 若新版的 `config.json` / `credentials/` 結構與舊版相容，可嘗試將舊的設定與憑證**手動對應**過去；若不相容，請以 **OpenClaw 官方文件** 為準，必要時在 `openclaw onboard` 或設定畫面重新填寫，再從舊備份中**手動抄寫** API Key、Token 等，勿直接覆蓋不明結構的檔案。

- **對話歷史 / sessions**  
  - 舊備份的 sessions 在 `clawdbot/agents/main/sessions/`；OpenClaw 文檔提到 `sessions.json`。  
  - 若官方未提供從 Clawdbot 匯入的說明，可僅還原 workspace（記憶與知識），對話歷史視為可捨棄或僅供參考。

**還原指令範例（僅 workspace；設定與憑證請依上段手動處理）**：

```bash
# 先完成 openclaw 安裝並至少執行過一次 onboard，確保 ~/.openclaw 存在
# 還原工作區記憶與知識到 OpenClaw workspace
cp -R "/Users/user/Downloads/備份指南/clawdbot-full-backup-20260202/workspace-memory-and-knowledge/"* ~/.openclaw/workspace/
```

---

## 四、重裝後對應原防護層級（依健檢報告）

重裝完成並還原資料後，請對照《**OpenClaw-安全與安裝健檢報告-2026-02-02.md**》還原與原環境相同的防護。以下對應該報告中的 **Warn：3** 及可選加強項目（allowFrom、Control UI 僅本機、憑證檔權限、技能安全）。  
**路徑說明**：若安裝的是 OpenClaw，設定與資料在 `~/.openclaw/`；若仍為 ClawdBot，則為 `~/.clawdbot/`。下列指令以 `~/.openclaw` 為例，ClawdBot 使用者請改為 `~/.clawdbot`。

### 1. allowFrom（DM 權限鎖定）

- **目標**：僅允許特定使用者與 Bot 私訊；陌生人須經配對核准。  
- **作法**：  
  - 在設定檔（OpenClaw 多為 `config.json` 或等同結構）中設定：  
    - `channels.telegram.dmPolicy: "pairing"`（新使用者須配對核准）；  
    - `allowFrom` 保留您允許的 Telegram 使用者 ID，以及配對後允許時使用的 `"*"`（依您原設定）。  
  - **更嚴格**（僅允許名單內、不依賴配對後 `*`）：  
    - 設 `dmPolicy: "allowlist"`；  
    - `allowFrom` 只保留允許的 Telegram user ID（數字），**移除 `"*"`**。  
- **還原建議**：可從備份 `clawdbot-full-backup-20260202/clawdbot/clawdbot.json` 中抄寫 `channels.telegram`、`allowFrom` 等相關區塊到新設定檔（結構相容時），或依上述說明手動設定。

### 2. Control UI 僅本機

- **目標**：Gateway 控制介面（例如埠 18789）只供本機存取，不暴露於公網。  
- **作法**：  
  - 設定 `gateway.bind: "loopback"`（或等同僅 listen 127.0.0.1），**不要**將 18789 綁定到 `0.0.0.0`。  
  - 本機存取：瀏覽器開啟 `http://127.0.0.1:18789/` 即可。  
- **對應健檢 Warn**：「Reverse proxy headers not trusted」「Control UI allows insecure HTTP auth」在 **僅 loopback** 的前提下可接受；若日後改為經 reverse proxy 或對外，再依指南設定 `gateway.trustedProxies` 與關閉 HTTP 不安全認證。

### 3. 憑證檔權限

- **目標**：憑證目錄與檔案僅擁有者可讀寫，避免被其他程式或使用者讀取。  
- **作法**：  
  ```bash
  # 憑證目錄：僅本人可進
  chmod 700 ~/.openclaw/credentials

  # 目錄內所有檔案：僅本人可讀寫
  chmod 600 ~/.openclaw/credentials/*
  ```  
  - 日後每在 `credentials/` 下新增檔案，建議再執行一次 `chmod 600 ~/.openclaw/credentials/*`。

### 4. 技能 (Skills) 安全

- **目標**：與健檢報告及「全方位實作與安全指南」一致：不盲目安裝來路不明的技能，避免惡意技能竊取 API 金鑰或破壞系統。  
- **作法**：  
  - 從 ClawdHub 或社群安裝技能前，**從 GitHub 等可信來源下載**，並**自行審核程式碼**後再安裝。  
  - 不要僅依賴市集預設信任；本機未做額外掃描時，至少做到來源可信＋手動檢視程式碼。

### 5. 安全審核與 Warn：3 對應

- **執行審核**（重裝後建議至少執行一次）：  
  ```bash
  openclaw security audit --deep
  ```  
  若仍使用 ClawdBot 指令：`clawdbot security audit --deep`。  
- **Warn：3 的對應**（與健檢報告一致）：  
  | 審核項目 | 本機建議 |
  |----------|----------|
  | Reverse proxy headers not trusted | 維持 **bind=loopback** 時可不設定 `gateway.trustedProxies`；若改為對外或 reverse proxy 再依指南設定。 |
  | Control UI allows insecure HTTP auth | 僅 listen 127.0.0.1 時風險可接受；若改為對外或 HTTPS 再關閉不安全 HTTP 認證。 |
  | Some models below recommended tiers | 可選：將 fallbacks 改為較新／大模型以提升抗 prompt 注入；非必須。 |

完成以上五項後，重裝環境的防護層級即可對應到原健檢報告中的應用層防護與 Warn 處理方式。

---

## 五、建議操作順序（簡要）

1. **重裝與安全**：完全依照  
   - **OpenClaw 本機安裝與安全重裝指南.md**  
   - **OpenClaw (原 ClawdBot) 全方位實作與安全指南 (1).md**  
   的安裝、onboard、驗證、安全審核與（若要做）卸載／重裝五步驟。  

2. **還原 2026-02-02 備份**：  
   - 先還原 **workspace**（上述 `workspace-memory-and-knowledge` → `~/.openclaw/workspace`）。  
   - 設定與憑證以官方結構為準，必要時手動對應或重新設定。  

3. **對應原防護層級**：依上方 **「四、重裝後對應原防護層級」** 完成 allowFrom、Control UI 僅本機、憑證檔權限、技能安全，並執行 `openclaw security audit --deep`，使 Warn：3 的處理方式與健檢報告一致。

這樣即可在**以兩份文檔為準**的前提下重裝，在保護原有記憶與知識下還原備份，並**維持與原環境相同的防護層級**。
